variables:
  LC_ALL: "en_US.UTF-8"
  LANG: "en_US.UTF-8"

before_script:
  - "~/unlock_ci_keychain.sh"
  - "gem update fastlane"
  - fastlane update_profiles

stages:
  - build 
  - crashlytics
  - night_build

build_master_job:
  stage: build
  script:
    - fastlane fastlane deploy_master deploy:false
  tags:
    - mac-mini-2-hipmo

build_slave_job:
  stage: build
  script:
    - fastlane fastlane deploy_slave deploy:false
  tags:
    - mac-mini-2-hipmo

crashlytics_master_job:
  stage: crashlytics
  script:
    - fastlane update_profiles
    - fastlane fastlane deploy_master deploy:true
  when: manual
  tags:
    - mac-mini-2-hipmo


crashlytics_slave_job:
  stage: crashlytics
  script:
    - fastlane update_profiles
    - fastlane fastlane deploy_slave deploy:true
  when: manual
  tags:
    - mac-mini-2-hipmo

crashlytics_job_night_build:
  stage: night_build
  script:
    - fastlane update_profiles
    - fastlane fastlane deploy_master deploy:true
    - fastlane fastlane deploy_slave deploy:true
  tags:
    - mac-mini-2-hipmo
  only:
    - schedules